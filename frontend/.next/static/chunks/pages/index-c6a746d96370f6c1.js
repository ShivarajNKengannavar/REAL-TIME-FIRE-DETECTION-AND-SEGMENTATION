(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(2108)}])},2108:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return Home}});var s=t(5893),n=t(7294),a=t(5152),l=t.n(a),r=t(6459),d=t(6254),c=t(8186),o=t(232),h=t(8029),u=t(2206),p=t(8491),x=t(6610),j=t(2845),g=t(92),m=t(3636),v=t(3244),b=t(8318),S=t(7642),y=t(2761),f=t(4760),components_ImageAnalysis=e=>{let{onAnalysisComplete:i}=e,[t,a]=(0,n.useState)(null),[l,d]=(0,n.useState)(""),[o,x]=(0,n.useState)(!1),j=(0,r.p)(),handleAnalyze=async()=>{if(!t){j({title:"No image selected",status:"warning",duration:3e3});return}x(!0);let e=new FormData;e.append("image",t);try{let t=await fetch("http://localhost:5000/analyze_image",{method:"POST",body:e}),s=await t.json();i(s),j({title:"Analysis Complete",description:"Fire Risk Level: ".concat((100*s.risk_level).toFixed(1),"%"),status:s.risk_level>.7?"error":"info",duration:5e3})}catch(e){j({title:"Analysis Failed",description:"Please try again",status:"error",duration:3e3})}finally{x(!1)}};return(0,s.jsx)(c.g,{spacing:4,align:"stretch",w:"100%",children:(0,s.jsx)(h.x,{borderWidth:1,borderRadius:"lg",p:4,children:(0,s.jsxs)(c.g,{spacing:4,children:[(0,s.jsx)(u.I,{type:"file",accept:"image/*",onChange:e=>{var i;let t=null===(i=e.target.files)||void 0===i?void 0:i[0];if(t){a(t);let e=new FileReader;e.onloadend=()=>{d(e.result)},e.readAsDataURL(t)}},hidden:!0,id:"image-upload"}),(0,s.jsx)(p.z,{as:"label",htmlFor:"image-upload",colorScheme:"blue",children:"Choose File"}),t&&(0,s.jsxs)(g.x,{fontSize:"sm",color:"gray.600",children:["Selected: ",t.name]}),l&&(0,s.jsx)(h.x,{maxH:"300px",overflow:"hidden",children:(0,s.jsx)(y.E,{src:l,alt:"Preview",maxH:"300px",objectFit:"contain"})}),(0,s.jsx)(p.z,{onClick:handleAnalyze,isLoading:o,colorScheme:"green",isDisabled:!t,children:"Analyze"}),o&&(0,s.jsx)(f.E,{size:"xs",isIndeterminate:!0,w:"100%"})]})})})},T=t(3658),w=t(4703),C=t(1901),z=t(7167),k=t(4476),_=t(6007),A=t(3416),R=t(4032),D=t(9860),I=t(941),F=t(9244),E=t(5490),W=t(4614),P=t(5139),V=t(7391),X=t(10),O=t(5443),components_VehicleDispatch=e=>{let{incidentLocation:i}=e,[t,a]=(0,n.useState)([]),[l,d]=(0,n.useState)({"Fire Truck":0,Ambulance:0}),[x,j]=(0,n.useState)([]),{isOpen:m,onOpen:v,onClose:b}=(0,T.q)(),S=(0,r.p)();(0,n.useEffect)(()=>{let e=Array.from({length:10},(e,i)=>({id:"V-".concat((i+1).toString().padStart(3,"0")),type:i%2==0?"Fire Truck":"Ambulance",status:"available",lastUpdate:new Date().toISOString(),arrived:null}));a(e);let i=setInterval(()=>a(e=>[...e]),6e4);return()=>clearInterval(i)},[]);let handleQuantityChange=(e,i)=>{d(t=>({...t,[e]:i}))},handleRecall=e=>{let i=t.map(i=>i.id===e?{...i,status:"available",dispatchedTo:void 0,dispatchedAt:void 0,arrived:null,lastUpdate:new Date().toISOString()}:i);a(i),S({title:"Vehicle Recalled",description:"Vehicle ".concat(e," is now available."),status:"info",duration:4e3})},handleArrivalStatus=(e,i)=>{a(t=>t.map(t=>t.id===e?{...t,arrived:i}:t))},getStatusColor=e=>{switch(e){case"available":return"green";case"dispatched":return"orange";case"maintenance":return"red";default:return"gray"}},getTimeAgo=e=>{if(!e)return"—";let i=Date.now()-new Date(e).getTime(),t=Math.floor(i/6e4);return 0===t?"Just now":"".concat(t," minute(s) ago")};return(0,s.jsxs)(h.x,{borderWidth:1,borderRadius:"lg",p:4,children:[(0,s.jsxs)(c.g,{spacing:6,align:"stretch",children:[(0,s.jsx)(o.X,{size:"md",children:"Emergency Vehicles"}),(0,s.jsxs)(c.g,{align:"start",spacing:3,children:[(0,s.jsx)(g.x,{children:"Select Vehicle Quantities"}),["Fire Truck","Ambulance"].map(e=>(0,s.jsxs)(h.x,{display:"flex",alignItems:"center",children:[(0,s.jsxs)(g.x,{children:[e,":"]}),(0,s.jsx)(u.I,{type:"number",value:l[e],onChange:i=>handleQuantityChange(e,parseInt(i.target.value)||0),min:0,max:t.filter(i=>i.type===e&&"available"===i.status).length,ml:2,width:"60px"})]},e))]}),(0,s.jsx)(p.z,{colorScheme:"blue",size:"sm",alignSelf:"flex-start",onClick:()=>{let e=[];if(Object.entries(l).forEach(i=>{let[s,n]=i;if(n>0){let i=t.filter(e=>e.type===s&&"available"===e.status);e.push(...i.slice(0,n))}}),0===e.length){S({title:"No Vehicles Available",description:"Please select a quantity for at least one vehicle type.",status:"warning",duration:4e3});return}j(e),v()},isDisabled:Object.values(l).every(e=>0===e),children:"Dispatch Selected Vehicles"}),(0,s.jsx)(o.X,{size:"sm",children:"All Vehicles"}),(0,s.jsxs)(w.i,{variant:"simple",size:"sm",children:[(0,s.jsx)(C.h,{children:(0,s.jsxs)(z.Tr,{children:[(0,s.jsx)(k.Th,{children:"ID"}),(0,s.jsx)(k.Th,{children:"Type"}),(0,s.jsx)(k.Th,{children:"Status"}),(0,s.jsx)(k.Th,{children:"Dispatched To"}),(0,s.jsx)(k.Th,{children:"Action"})]})}),(0,s.jsx)(_.p,{children:t.map(e=>(0,s.jsxs)(z.Tr,{children:[(0,s.jsx)(A.Td,{children:e.id}),(0,s.jsx)(A.Td,{children:e.type}),(0,s.jsx)(A.Td,{children:(0,s.jsx)(R.C,{colorScheme:getStatusColor(e.status),children:e.status})}),(0,s.jsx)(A.Td,{children:"dispatched"===e.status?e.dispatchedTo||"Unknown":"—"}),(0,s.jsx)(A.Td,{children:"dispatched"===e.status?(0,s.jsx)(p.z,{size:"sm",colorScheme:"yellow",onClick:()=>handleRecall(e.id),children:"Recall"}):(0,s.jsx)(p.z,{size:"sm",isDisabled:!0,children:"—"})})]},e.id))})]}),(0,s.jsx)(o.X,{size:"sm",children:"Dispatched Vehicle Status"}),(0,s.jsxs)(w.i,{variant:"simple",size:"sm",children:[(0,s.jsx)(C.h,{children:(0,s.jsxs)(z.Tr,{children:[(0,s.jsx)(k.Th,{children:"ID"}),(0,s.jsx)(k.Th,{children:"Type"}),(0,s.jsx)(k.Th,{children:"Dispatched To"}),(0,s.jsx)(k.Th,{children:"Time"}),(0,s.jsx)(k.Th,{children:"Reached?"})]})}),(0,s.jsx)(_.p,{children:t.filter(e=>"dispatched"===e.status).map(e=>(0,s.jsxs)(z.Tr,{children:[(0,s.jsx)(A.Td,{children:e.id}),(0,s.jsx)(A.Td,{children:e.type}),(0,s.jsx)(A.Td,{children:e.dispatchedTo||"Unknown"}),(0,s.jsx)(A.Td,{children:getTimeAgo(e.dispatchedAt)}),(0,s.jsx)(A.Td,{children:(0,s.jsx)(D.E,{onChange:i=>handleArrivalStatus(e.id,"yes"===i),value:!0===e.arrived?"yes":!1===e.arrived?"no":"",children:(0,s.jsxs)(I.K,{direction:"row",children:[(0,s.jsx)(F.Y,{value:"yes",children:"Yes"}),(0,s.jsx)(F.Y,{value:"no",children:"No"})]})})})]},e.id))})]})]}),(0,s.jsxs)(E.u_,{isOpen:m,onClose:b,children:[(0,s.jsx)(W.Z,{}),(0,s.jsxs)(P.h,{children:[(0,s.jsx)(V.x,{children:"Confirm Dispatch"}),(0,s.jsx)(X.f,{children:(0,s.jsxs)(c.g,{align:"stretch",spacing:3,children:[(0,s.jsxs)(g.x,{children:["Dispatch ",x.length," vehicle(s) to"," ",(0,s.jsx)("strong",{children:(null==i?void 0:i.address)||"Unknown Location"}),"?"]}),x.map(e=>(0,s.jsxs)(g.x,{children:["• ",e.type," (",e.id,")"]},e.id))]})}),(0,s.jsxs)(O.m,{children:[(0,s.jsx)(p.z,{colorScheme:"blue",mr:3,onClick:()=>{let e=new Date().toISOString(),s=t.map(t=>x.some(e=>e.id===t.id)?{...t,status:"dispatched",dispatchedTo:(null==i?void 0:i.address)||"Unknown",dispatchedAt:e,arrived:null,lastUpdate:e}:t);a(s),d({"Fire Truck":0,Ambulance:0}),j([]),b(),S({title:"Vehicles Dispatched",description:"".concat(x.length," vehicle(s) dispatched."),status:"success",duration:5e3})},children:"Confirm"}),(0,s.jsx)(p.z,{variant:"ghost",onClick:b,children:"Cancel"})]})]})]})]})};let U=l()(()=>Promise.all([t.e(269),t.e(920)]).then(t.bind(t,8920)),{loadableGenerated:{webpack:()=>[8920]},ssr:!1}),N=(0,S.io)("http://localhost:5000");function Home(){let[e,i]=(0,n.useState)("http://localhost:5000/video_feed"),[t,a]=(0,n.useState)(""),[l,S]=(0,n.useState)(null),[y,f]=(0,n.useState)(null),[T,w]=(0,n.useState)("commercial"),[C,z]=(0,n.useState)([]),[k,_]=(0,n.useState)("pending"),[A,R]=(0,n.useState)(""),D=(0,r.p)(),handleSearch=async()=>{try{let e=await fetch("http://localhost:5000/search_location?address=".concat(encodeURIComponent(t))),i=await e.json();i.error?D({title:"Location Error",description:i.error,status:"error",duration:3e3}):S(i)}catch(e){D({title:"Search Error",description:"Failed to search location",status:"error",duration:3e3})}};(0,n.useEffect)(()=>(N.on("connect",()=>{console.log("Connected to WebSocket")}),N.on("update",e=>{(null==e?void 0:e.heatmap_data)&&f(e.heatmap_data),(null==e?void 0:e.max_risk)>.7&&D({title:"High Risk Alert!",description:"Fire risk level: ".concat((100*e.max_risk).toFixed(1),"%"),status:"error",duration:5e3,isClosable:!0})}),()=>{N.disconnect(),console.log("Disconnected from WebSocket")}),[]);let handleZoneChange=async e=>{w(e);try{let i=await fetch("http://localhost:5000/analyze_zone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({zone_type:e,lat:12.9716,lon:77.5946})}),t=await i.json();t&&t.lat&&t.lon&&z(e=>[...e,t])}catch(e){console.error("Error analyzing zone:",e)}};return(0,s.jsx)(d.W,{maxW:"container.xl",py:5,children:(0,s.jsxs)(c.g,{spacing:5,align:"stretch",children:[(0,s.jsx)(o.X,{as:"h1",size:"xl",textAlign:"center",mb:6,children:"Real-Time Fire Segmentation System"}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Location Search"}),(0,s.jsx)(u.I,{placeholder:"Enter city, address, or landmark...",value:t,onChange:e=>a(e.target.value)}),(0,s.jsx)(p.z,{mt:2,onClick:handleSearch,children:"Search"})]}),(0,s.jsxs)(x.r,{templateColumns:{base:"1fr",lg:"repeat(2, 1fr)"},gap:6,children:[(0,s.jsxs)(c.g,{spacing:4,align:"stretch",children:[(0,s.jsx)(h.x,{borderWidth:1,borderRadius:"lg",overflow:"hidden",children:(0,s.jsx)("img",{src:e,alt:"Video Feed",style:{width:"100%"}})}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Zone Analysis"}),(0,s.jsxs)(j.P,{value:T,onChange:e=>handleZoneChange(e.target.value),children:[(0,s.jsx)("option",{value:"commercial",children:"Commercial Zone"}),(0,s.jsx)("option",{value:"residential",children:"Residential Zone"}),(0,s.jsx)("option",{value:"industrial",children:"Industrial Zone"})]})]})]}),(0,s.jsxs)(c.g,{spacing:4,align:"stretch",children:[(0,s.jsx)(h.x,{h:"400px",borderWidth:1,borderRadius:"lg",overflow:"hidden",children:(0,s.jsx)(U,{incidents:C})}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Risk Analysis"}),y?(0,s.jsx)(h.x,{id:"heatmap",children:(0,s.jsx)(g.x,{children:"Heatmap data received and processed."})}):(0,s.jsx)(g.x,{children:"No heatmap data yet."})]}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Upload Image for Analysis"}),(0,s.jsx)(components_ImageAnalysis,{onAnalysisComplete:e=>{(null==e?void 0:e.risk_level)>.5&&D({title:"High Risk Detected",description:"Fire risk level: ".concat((100*e.risk_level).toFixed(1),"%"),status:"error",duration:5e3,isClosable:!0}),f(null==e?void 0:e.heatmap_data)}})]}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Case Status"}),(0,s.jsxs)(m.U,{spacing:3,children:["pending"===k?(0,s.jsx)(b.FXL,{color:"red",size:24}):"in_process"===k?(0,s.jsx)(b.cfq,{color:"orange",size:24}):(0,s.jsx)(b.cfq,{color:"black",size:24}),(0,s.jsxs)(j.P,{value:k,onChange:e=>_(e.target.value),colorScheme:"pending"===k?"red":"in_process"===k?"orange":"green",children:[(0,s.jsx)("option",{value:"pending",children:"Pending Inspection"}),(0,s.jsx)("option",{value:"in_process",children:"In Process"}),(0,s.jsx)("option",{value:"rejected",children:"Rejected Application"})]})]}),(0,s.jsx)(g.x,{mt:2,color:"pending"===k?"red.500":"in_process"===k?"orange.500":"green.500",children:"pending"===k?"Pending inspection. Awaiting review.":"in_process"===k?"Inspection in process.":"Application rejected."})]}),(0,s.jsxs)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:[(0,s.jsx)(o.X,{size:"md",mb:4,children:"Describe the Situation"}),(0,s.jsx)(v.g,{value:A,onChange:e=>R(e.target.value),placeholder:"Explain the situation in detail...",size:"md"})]}),(0,s.jsx)(h.x,{p:4,borderWidth:1,borderRadius:"lg",children:(0,s.jsx)(p.z,{colorScheme:"blue",onClick:()=>{if(!A){D({title:"Error",description:"Please provide a description of the situation.",status:"error",duration:3e3});return}console.log("Case Status:",k),console.log("Situation Description:",A),D({title:"Case Submitted",description:"Your case has been submitted for study.",status:"success",duration:3e3})},children:"Submit Case for Study"})}),(0,s.jsx)(components_VehicleDispatch,{incidentLocation:null!=l?l:void 0})]})]})]})})}}},function(e){e.O(0,[660,544,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);